<html>
  <head>
    <title>ESP Desk Display</title>
    <style>
      body {
        background-color: #222;
        color: #eee;
        font-family: Arial, sans-serif;
        padding: 20px;
      }

      h1 {
        color: #ffcc00;
      }

      input[type="text"], input[type="number"], select, button, input[type="range"] {
        background-color: #444;
        color: #eee;
        border: 1px solid #888;
        padding: 5px 10px;
        margin: 5px 0;
        font-size: 1em;
        border-radius: 8px;
        outline: none;
      }

      button {
        color: #222;
        background-color: #e1ff00;
        border: none;
        cursor: pointer;
        border-radius: 8px;
        padding: 6px 14px;
      }

      button:hover {
        background-color: #a2ff00;
      }

      label {
        display: block;
        margin-top: 10px;
      }

      #message-fields, #delay-field, #weather-fields {
        display: none;
      }

      #brightness-container {
        margin-top: 20px;
      }
    </style>
    <script>
      function updateFields() {
        const mode = document.getElementById("mode").value;
        const messageFields = document.getElementById("message-fields");
        const weatherFields = document.getElementById("weather-fields");

        if (mode === "message") {
          messageFields.style.display = "block";
          weatherFields.style.display = "none";
        } else if (mode === "weather") {
          messageFields.style.display = "none";
          weatherFields.style.display = "block";
        } else {
          messageFields.style.display = "none";
          weatherFields.style.display = "none";
        }
      }

      function toggleDelayField() {
        const scrollBox = document.getElementById("scroll");
        const delayField = document.getElementById("delay-field");
        delayField.style.display = scrollBox.checked ? "block" : "none";
      }

      function updateBrightness(value) {
        document.getElementById("brightness-value").innerText = value;
        fetch(`/brightness?value=${value}`);
      }

      async function loadBrightness() {
        try {
          const response = await fetch("/get_brightness");
          if (response.ok) {
            const value = await response.text();
            const slider = document.getElementById("brightness");
            const label = document.getElementById("brightness-value");
            slider.value = value;
            label.innerText = value;
          }
        } catch (e) {
          console.error("Failed to fetch brightness:", e);
        }
      }

      window.onload = function() {
        updateFields();
        toggleDelayField();
        loadBrightness();
      };
    </script>
  </head>
  <body>
    <h1>ESP Desk Display</h1>
    <form action="/set" method="get">
      <label for="row">Row:</label>
      <select name="row" id="row">
        <option value="0">Top</option>
        <option value="1">Bottom</option>
      </select>

      <label for="mode">Mode:</label>
      <select name="mode" id="mode" onchange="updateFields()">
        <option value="message">Message</option>
        <option value="clock">Clock</option>
        <option value="weather">Weather</option>
      </select>

      <div id="message-fields">
        <label for="msg">Message:</label>
        <input type="text" id="msg" name="msg">

        <label>
          <input type="checkbox" id="scroll" name="scroll" onclick="toggleDelayField()">
          Scrolling?
        </label>

        <div id="delay-field">
          <label for="delay">Delay (ms):</label>
          <input type="number" id="delay" name="delay" value="300" min="50" max="2000">
        </div>
      </div>

      <div id="weather-fields">
        <label>
          <input type="checkbox" id="symbol" name="symbol">
          Show as symbols
        </label>
      </div>

      <div id="brightness-container">
        <label for="brightness">Brightness:</label>
        <input type="range" id="brightness" name="brightness" min="0" max="256" value="256" oninput="updateBrightness(this.value)">
        <span id="brightness-value">255</span>
      </div>

      <br>
      <button type="submit">Set</button>
    </form>
  </body>
</html>
